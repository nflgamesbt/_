<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="icon" href="favicon.svg" />
<title>TurboPlayz — Astro Dodger</title>
<meta name="description" content="Astro Dodger — dodge asteroids, collect orbs, and top the local leaderboard on TurboPlayz." />
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet" />
<style>
  :root{
    --bg: #050914;
    --card: #0d1321;
    --muted: #94a3b8;
    --text: #f8fafc;
    --accentA: #ff004d;
    --accentB: #00d4ff;
    --shadow: 0 12px 35px rgba(0,0,0,.45);
    --radius: 12px;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
    background:linear-gradient(180deg,var(--bg),#071027);
    color:var(--text);
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    line-height:1.35;
  }
  .container{max-width:1100px;margin:0 auto;padding:20px}
  nav.nav{padding:14px 0;background:transparent}
  .nav-inner{display:flex;align-items:center;justify-content:space-between;gap:12px}
  .logo{display:flex;align-items:center;gap:10px;text-decoration:none;color:var(--text);font-weight:800}
  .logo img{width:36px;height:36px}
  .menu a{color:var(--muted);text-decoration:none;margin-right:12px;font-weight:600}
  .menu a[style]{color:var(--text)} /* keeps Play Game highlighted like your original */
  .right{display:flex;gap:10px;align-items:center}
  .btn{
    background:linear-gradient(90deg,var(--accentA),var(--accentB));
    color:#021425;
    padding:10px 14px;border-radius:10px;border:0;font-weight:700;cursor:pointer;
    box-shadow:var(--shadow);
    text-decoration:none;
  }
  .btn.ghost{
    background:transparent;border:1px solid rgba(255,255,255,.06);color:var(--text);
  }

  header.hero{padding:34px 0;text-align:center}
  header.hero h1{margin:6px 0 6px;font-size:28px;letter-spacing:0.5px}
  header.hero p{color:var(--muted);margin:0 0 12px}
  .kudos{display:flex;gap:8px;justify-content:center;flex-wrap:wrap;margin-top:10px}
  .pill{background:rgba(255,255,255,0.03);padding:6px 10px;border-radius:999px;color:var(--muted);font-weight:600}

  .section{padding:18px 0}
  .card{
    background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border-radius:var(--radius); padding:18px; box-shadow:var(--shadow); border:1px solid rgba(255,255,255,0.03);
  }

  /* small helpers */
  .controls{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin-top:10px}
  .status-row{display:flex;justify-content:space-between;align-items:center;gap:12px;margin-top:12px;color:var(--muted);font-weight:700}
  .badge{background:rgba(0,0,0,0.25);padding:6px 8px;border-radius:8px;color:var(--muted)}

  footer.footer{padding:18px 0;color:var(--muted)}

  /* responsive canvas */
  .canvas-wrap{display:flex;flex-direction:column;align-items:center}
  canvas{display:block;width:100%;max-width:900px;border-radius:16px;border:1px solid rgba(255,255,255,.06);background:linear-gradient(180deg,#071025,#08132b)}

  @media (max-width:520px){
    .nav-inner{flex-wrap:wrap}
    .logo span{display:none}
    header.hero h1{font-size:20px}
  }
</style>
</head>
<body>
<nav class="nav">
  <div class="container nav-inner">
    <a class="logo" href="index.html" aria-label="Home">
      <img src="assets/img/logo.svg" alt="TurboPlayz icon"><span>TurboPlayz</span>
    </a>
    <div class="menu" data-nav-menu>
      <a href="index.html" >Home</a>
      <a href="game.html" style='opacity:1;font-weight:800'>Play Game</a>
      <a href="leaderboard.html" >Leaderboard</a>
      <a href="about.html" >About</a>
      <a href="blog.html" >Blog</a>
      <a href="faq.html" >FAQ</a>
      <a href="#contact">Contact</a>
    </div>
    <div class="right">
      <a class="btn ghost" data-nav-toggle>Menu</a>
      <a class="btn" href="game.html">Play</a>
    </div>
  </div>
</nav>

<header class="hero">
  <div class="container">
    <h1>Astro Dodger — Mini Game</h1>
    <p>Control a ship and dodge falling asteroids. Collect energy orbs for points. Use Shield (Space) to survive tight spots.</p>
    <div class="kudos">
      <span class="pill">Shield Orb</span>
      <span class="pill">Energy Orbs</span>
      <span class="pill">Local Leaderboard</span>
    </div>
  </div>
</header>

<section class="section container">
  <div class="card canvas-wrap" style="text-align:center">
    <canvas id="game" width="900" height="520" aria-label="Game canvas" tabindex="0"></canvas>
    <div style="height:12px"></div>

    <div class="controls">
      <button class="btn" id="btn-pause">Pause</button>
      <button class="btn" id="btn-restart">Save score & Restart</button>
      <a class="btn ghost" href="leaderboard.html" id="view-leaderboard">View Leaderboard</a>
      <a class="btn ghost" href="index.html">Back Home</a>
    </div>

    <div class="status-row" style="width:100%;max-width:900px;margin-top:14px">
      <div>Score: <span id="score">0</span></div>
      <div class="badge">Shield: <span id="shield-count">0</span></div>
      <div class="badge">Multiplier: <span id="mult">1x</span></div>
    </div>
  </div>
</section>

<footer class="footer">
  <div class="container" style="display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap">
    <div>© 2025 TurboPlayz. All rights reserved.</div>
    <div style="display:flex;gap:12px;align-items:center">
      <span class="badge">Responsive • Age-gate</span>
    </div>
  </div>
</footer>

<script>
/*
  Astro Dodger - single-file game logic
  - Left/Right: Arrow keys or A/D
  - Space: shield (temporary)
  - P: pause
  - R: restart
  - Save score on Restart button to localStorage key "turboplayz_leaderboard"
*/

(() => {
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');
  let W = canvas.width;
  let H = canvas.height;

  // Resize handling for high-DPI and responsive width
  function resizeCanvas() {
    // keep internal resolution fixed (900x520) but scale to CSS width while keeping aspect
    const wrapperWidth = Math.min(document.querySelector('.canvas-wrap').clientWidth, 900);
    const scale = wrapperWidth / 900;
    canvas.style.width = wrapperWidth + 'px';
    canvas.style.height = (520 * scale) + 'px';
  }
  window.addEventListener('resize', resizeCanvas);
  resizeCanvas();

  // Game state
  let keys = {};
  let score = 0;
  let running = true;
  let gameOver = false;
  let spawnTimer = 0;
  let spawnInterval = 900; // ms
  let lastTime = performance.now();
  let asteroids = [];
  let orbs = [];
  let powerups = [];
  let multiplier = 1;
  let multTimer = 0;
  let player = {
    x: W/2,
    y: H - 80,
    w: 44,
    h: 30,
    speed: 320, // px/s
    shieldActive: false,
    shieldCount: 0,
    shieldTimer: 0
  };

  // Utility: random
  const rand = (min,max) => Math.random()*(max-min)+min;

  // Spawn functions
  function spawnAsteroid() {
    const size = rand(20,70);
    asteroids.push({
      x: rand(size/2, W - size/2),
      y: -size,
      r: size/2,
      vy: rand(80, 220) + Math.min(0, score * 0.2) // slightly scale with score
    });
  }
  function spawnOrb() {
    const size = 18;
    orbs.push({
      x: rand(size/2, W - size/2),
      y: -size,
      r: size/2,
      vy: rand(100,160)
    });
  }
  function spawnPowerup() {
    const types = ['shield','mult'];
    powerups.push({
      x: rand(24, W-24),
      y: -28,
      type: types[Math.floor(Math.random()*types.length)],
      vy: rand(90,140)
    });
  }

  // Input
  window.addEventListener('keydown', e => {
    if (e.code === 'KeyP') togglePause();
    if (e.code === 'KeyR') restartGame(false);
    keys[e.code] = true;
  });
  window.addEventListener('keyup', e => keys[e.code] = false);

  // Mobile drag support
  let dragging = false;
  let lastClientX = null;
  canvas.addEventListener('touchstart', e => {
    dragging = true;
    lastClientX = e.touches[0].clientX;
  }, {passive:true});
  canvas.addEventListener('touchmove', e => {
    if (!dragging) return;
    const dx = e.touches[0].clientX - lastClientX;
    // convert to canvas space proportionally
    const rect = canvas.getBoundingClientRect();
    const scale = canvas.width / rect.width;
    player.x += dx * scale;
    lastClientX = e.touches[0].clientX;
  }, {passive:true});
  canvas.addEventListener('touchend', () => { dragging=false; lastClientX=null; });

  // Buttons
  document.getElementById('btn-pause').addEventListener('click', togglePause);
  document.getElementById('btn-restart').addEventListener('click', () => restartGame(true));

  // Score UI
  const scoreEl = document.getElementById('score');
  const shieldCountEl = document.getElementById('shield-count');
  const multEl = document.getElementById('mult');

  // Leaderboard storage
  const LB_KEY = 'turboplayz_leaderboard';
  function saveScoreToLeaderboard(name = 'Player', s = score) {
    try {
      const raw = localStorage.getItem(LB_KEY);
      const arr = raw ? JSON.parse(raw) : [];
      arr.push({name, score: Math.floor(s), date: new Date().toISOString()});
      // keep top 50 sorted desc
      arr.sort((a,b) => b.score - a.score);
      localStorage.setItem(LB_KEY, JSON.stringify(arr.slice(0,50)));
    } catch(e){
      console.warn('Unable to save leaderboard', e);
    }
  }

  // Collision helpers
  function circleRectColl(cx, cy, cr, rx, ry, rw, rh) {
    // Find closest point to circle within rect
    const closestX = Math.max(rx - rw/2, Math.min(cx, rx + rw/2));
    const closestY = Math.max(ry - rh/2, Math.min(cy, ry + rh/2));
    const dx = cx - closestX;
    const dy = cy - closestY;
    return (dx*dx + dy*dy) < (cr*cr);
  }

  // Game loop
  function update(now) {
    if (!running) {
      lastTime = now;
      requestAnimationFrame(update);
      return;
    }
    const dt = Math.min(60, now - lastTime) / 1000; // cap dt
    lastTime = now;

    // movement input
    let move = 0;
    if (keys['ArrowLeft'] || keys['KeyA']) move -= 1;
    if (keys['ArrowRight'] || keys['KeyD']) move += 1;
    player.x += move * player.speed * dt;
    // clamp
    player.x = Math.max(player.w/2, Math.min(W - player.w/2, player.x));

    // spawn logic
    spawnTimer += (dt * 1000);
    const dynamicInterval = Math.max(400, spawnInterval - Math.min(500, score * 3)); // faster with score
    if (spawnTimer > dynamicInterval) {
      spawnTimer = 0;
      // spawn a mix
      if (Math.random() < 0.7) spawnAsteroid();
      if (Math.random() < 0.18) spawnOrb();
      if (Math.random() < 0.08) spawnPowerup();
    }

    // update asteroids
    for (let i = asteroids.length-1; i>=0; i--) {
      const a = asteroids[i];
      a.y += a.vy * dt;
      if (a.y - a.r > H + 40) asteroids.splice(i,1);
      // collision with player
      if (!gameOver && circleRectColl(a.x, a.y, a.r, player.x, player.y, player.w, player.h)) {
        if (player.shieldActive) {
          // destroy asteroid but reduce shield
          asteroids.splice(i,1);
          player.shieldActive = false;
          player.shieldTimer = 0;
        } else {
          gameOver = true;
          running = false;
        }
      }
    }

    // update orbs
    for (let i = orbs.length-1; i>=0; i--) {
      const o = orbs[i];
      o.y += o.vy * dt;
      if (o.y - o.r > H + 20) orbs.splice(i,1);
      if (!gameOver && circleRectColl(o.x, o.y, o.r, player.x, player.y, player.w, player.h)) {
        // collect
        score += Math.floor(10 * multiplier);
        orbs.splice(i,1);
      }
    }

    // update powerups
    for (let i = powerups.length-1; i>=0; i--) {
      const p = powerups[i];
      p.y += p.vy * dt;
      if (p.y > H + 20) powerups.splice(i,1);
      if (!gameOver && Math.abs(p.x - player.x) < 34 && Math.abs(p.y - player.y) < 30) {
        if (p.type === 'shield') {
          player.shieldCount += 1;
        } else if (p.type === 'mult') {
          multiplier = 2;
          multTimer = 8000; // ms
        }
        powerups.splice(i,1);
      }
    }

    // handle shield activation
    if (keys['Space']) {
      if (!player.shieldActive && player.shieldCount > 0) {
        player.shieldCount -= 1;
        player.shieldActive = true;
        player.shieldTimer = 5000; // ms
      }
      // prevent continuous activation while held
      keys['Space'] = false;
    }

    if (player.shieldActive) {
      player.shieldTimer -= dt*1000;
      if (player.shieldTimer <= 0) player.shieldActive = false;
    }

    // multiplier timer
    if (multiplier > 1) {
      multTimer -= dt*1000;
      if (multTimer <= 0) {
        multiplier = 1;
        multTimer = 0;
      }
    }

    // incremental score while alive
    if (!gameOver) {
      score += dt * (5 * multiplier); // passive score increase
    }

    // update UI
    scoreEl.textContent = Math.floor(score);
    shieldCountEl.textContent = player.shieldCount;
    multEl.textContent = multiplier + 'x';

    // draw
    draw();

    if (!gameOver) requestAnimationFrame(update);
    else {
      // final draw and stop
      draw(true);
      // focus canvas to allow R to restart
      canvas.focus();
    }
  }

  function draw(final=false) {
    // clear
    ctx.clearRect(0,0,W,H);
    // star field backdrop
    ctx.fillStyle = '#030516';
    ctx.fillRect(0,0,W,H);

    // slight gradient
    const g = ctx.createLinearGradient(0,0,0,H);
    g.addColorStop(0, 'rgba(5,9,20,0.0)');
    g.addColorStop(1, 'rgba(2,6,15,0.15)');
    ctx.fillStyle = g;
    ctx.fillRect(0,0,W,H);

    // draw orbs
    for (const o of orbs) {
      ctx.beginPath();
      ctx.fillStyle = '#ffd166';
      ctx.arc(o.x, o.y, o.r, 0, Math.PI*2);
      ctx.fill();
      ctx.closePath();
      ctx.beginPath();
      ctx.fillStyle = 'rgba(255,255,255,0.12)';
      ctx.arc(o.x-4, o.y-4, o.r/2.2, 0, Math.PI*2);
      ctx.fill();
      ctx.closePath();
    }

    // draw powerups
    for (const p of powerups) {
      ctx.save();
      ctx.translate(p.x, p.y);
      if (p.type === 'shield') {
        ctx.fillStyle = '#7dd3fc';
        ctx.beginPath();
        ctx.arc(0,0,12,0,Math.PI*2);
        ctx.fill();
        ctx.closePath();
        ctx.fillStyle = '#001f29';
        ctx.fillRect(-3,-8,6,12);
      } else {
        ctx.fillStyle = '#ff7ab6';
        ctx.beginPath();
        ctx.rect(-12,-10,24,20);
        ctx.fill();
        ctx.closePath();
        ctx.fillStyle = '#001219';
        ctx.fillRect(-2,-6,4,12);
      }
      ctx.restore();
    }

    // draw asteroids
    for (const a of asteroids) {
      ctx.save();
      ctx.translate(a.x, a.y);
      ctx.beginPath();
      // irregular shape with simple noise
      ctx.fillStyle = '#6b7280';
      ctx.moveTo(-a.r,0);
      for (let t=0;t<8;t++){
        const ang = (Math.PI*2/8)*t;
        const rad = a.r * (0.7 + 0.6*Math.sin(t*1.3 + a.y*0.02));
        ctx.lineTo(Math.cos(ang)*rad, Math.sin(ang)*rad);
      }
      ctx.closePath();
      ctx.fill();
      ctx.restore();
    }

    // draw player (ship)
    ctx.save();
    ctx.translate(player.x, player.y);
    // ship body
    ctx.beginPath();
    ctx.fillStyle = 'white';
    ctx.moveTo(-player.w/2, player.h/2);
    ctx.lineTo(-player.w/2, -player.h/2);
    ctx.quadraticCurveTo(0, -player.h - 6, player.w/2, -player.h/2);
    ctx.lineTo(player.w/2, player.h/2);
    ctx.closePath();
    // gradient tint
    const sg = ctx.createLinearGradient(-player.w/2, -player.h, player.w/2, player.h);
    sg.addColorStop(0, 'rgba(0,212,255,0.9)');
    sg.addColorStop(1, 'rgba(255,0,77,0.95)');
    ctx.fillStyle = sg;
    ctx.fill();

    // cockpit
    ctx.beginPath();
    ctx.fillStyle = 'rgba(2,6,15,0.85)';
    ctx.arc(0, -6, 8, 0, Math.PI*2);
    ctx.fill();

    // shield ring
    if (player.shieldActive) {
      ctx.beginPath();
      ctx.strokeStyle = 'rgba(124,58,237,0.9)';
      ctx.lineWidth = 4;
      ctx.arc(0,0,player.w,0,Math.PI*2);
      ctx.stroke();
    }
    ctx.restore();

    // HUD overlay (score already in DOM but nice to show)
    ctx.fillStyle = 'rgba(255,255,255,0.03)';
    ctx.fillRect(12,12,220,46);
    ctx.fillStyle = '#9ca3af';
    ctx.font = '600 14px Inter, sans-serif';
    ctx.fillText('Astro Dodger', 22, 32);
    ctx.fillStyle = '#fff';
    ctx.font = '700 20px Inter, sans-serif';
    ctx.fillText(Math.floor(score) + ' pts', 22, 50);

    if (final) {
      ctx.fillStyle = 'rgba(1,3,6,0.7)';
      ctx.fillRect(0, H/2 - 64, W, 128);
      ctx.fillStyle = '#fff';
      ctx.font = '800 34px Inter, sans-serif';
      ctx.textAlign = 'center';
      ctx.fillText('Game Over', W/2, H/2 - 6);
      ctx.font = '600 18px Inter, sans-serif';
      ctx.fillText('Press R or click "Save score & Restart" to play again', W/2, H/2 + 28);
      ctx.textAlign = 'start';
    }
  }

  // restart & pause
  function restartGame(saveScore) {
    if (saveScore && (score > 0)) {
      const name = prompt('Enter your name to save score (max 20 chars)', 'Player') || 'Player';
      saveScoreToLeaderboard(name.slice(0,20), Math.floor(score));
    }
    // reset
    score = 0;
    asteroids = [];
    orbs = [];
    powerups = [];
    multiplier = 1;
    multTimer = 0;
    player.x = W/2;
    player.y = H - 80;
    player.shieldActive = false;
    player.shieldCount = 0;
    player.shieldTimer = 0;
    gameOver = false;
    running = true;
    lastTime = performance.now();
    requestAnimationFrame(update);
  }

  function togglePause() {
    running = !running;
    document.getElementById('btn-pause').textContent = running ? 'Pause' : 'Resume';
    if (running) {
      lastTime = performance.now();
      requestAnimationFrame(update);
    }
  }

  // initial spawns so player isn't bored
  function warmUp() {
    spawnOrb(); spawnOrb();
    spawnAsteroid(); spawnAsteroid();
  }

  // initialize constants responsive to canvas internal size
  function initSizes() {
    W = canvas.width;
    H = canvas.height;
    player.x = W/2;
    player.y = H - 80;
  }

  // Kick off
  initSizes();
  warmUp();
  requestAnimationFrame(update);

  // focus canvas to accept R quickly
  canvas.setAttribute('tabindex','0');
  canvas.style.outline = 'none';
  canvas.addEventListener('click', () => canvas.focus());

  // Expose some debug helpers (optional)
  window.turbo = { restartGame, saveScoreToLeaderboard };

})();
</script>
</body>
</html>
